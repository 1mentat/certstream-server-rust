{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "Overview",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "yellow", "value": 100 }, { "color": "red", "value": 1000 }] },
          "unit": "cps"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 4, "x": 0, "y": 1 },
      "id": 1,
      "options": { "colorMode": "background", "graphMode": "area", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "Certs / sec",
      "type": "stat",
      "targets": [{ "expr": "sum(rate(certstream_messages_sent[1m]))", "legendFormat": "", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 4, "x": 4, "y": 1 },
      "id": 2,
      "options": { "colorMode": "background", "graphMode": "area", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "Total Certs",
      "type": "stat",
      "targets": [{ "expr": "sum(certstream_messages_sent)", "legendFormat": "", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 3, "x": 8, "y": 1 },
      "id": 3,
      "options": { "colorMode": "background", "graphMode": "none", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "RFC 6962 Logs",
      "type": "stat",
      "targets": [{ "expr": "certstream_ct_logs_count", "legendFormat": "", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "blue", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 3, "x": 11, "y": 1 },
      "id": 4,
      "options": { "colorMode": "background", "graphMode": "none", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "Static CT Logs",
      "type": "stat",
      "targets": [{ "expr": "certstream_static_ct_logs_count", "legendFormat": "", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "purple", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 4, "x": 14, "y": 1 },
      "id": 5,
      "options": { "colorMode": "background", "graphMode": "area", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "Duplicates Filtered",
      "type": "stat",
      "targets": [{ "expr": "certstream_duplicates_filtered", "legendFormat": "", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "green", "value": null }, { "color": "orange", "value": 1 }, { "color": "red", "value": 5 }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 3, "x": 18, "y": 1 },
      "id": 6,
      "options": { "colorMode": "background", "graphMode": "none", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "Worker Panics",
      "type": "stat",
      "targets": [{ "expr": "certstream_worker_panics or vector(0)", "legendFormat": "", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "steps": [{ "color": "semi-dark-orange", "value": null }] },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 5, "w": 3, "x": 21, "y": 1 },
      "id": 7,
      "options": { "colorMode": "background", "graphMode": "none", "orientation": "auto", "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "textMode": "auto" },
      "title": "Dedup Cache",
      "type": "stat",
      "targets": [{ "expr": "certstream_dedup_cache_size", "legendFormat": "", "refId": "A" }]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 6 },
      "id": 101,
      "title": "Certificate Sources â€” Per-Log Throughput",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "axisLabel": "certs/sec", "drawStyle": "bars", "fillOpacity": 80, "gradientMode": "scheme", "lineWidth": 0, "stacking": { "group": "A", "mode": "normal" } },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 7 },
      "id": 10,
      "options": {
        "legend": { "calcs": ["sum", "mean", "max"], "displayMode": "table", "placement": "right", "sortBy": "Total", "sortDesc": true },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Certificate Volume by Source",
      "description": "Certificates received per second from each CT log source. Use Grafana time range to view hourly/daily/weekly breakdowns.",
      "type": "timeseries",
      "targets": [
        {
          "expr": "topk(15, rate(certstream_messages_sent[5m])) > 0",
          "legendFormat": "{{log}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "drawStyle": "bars", "fillOpacity": 100, "stacking": { "group": "A", "mode": "percent" } },
          "unit": "percentunit"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 17 },
      "id": 11,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "right" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Source Distribution (%)",
      "description": "Percentage of total certificates contributed by each source over time.",
      "type": "timeseries",
      "targets": [
        {
          "expr": "topk(10, rate(certstream_messages_sent[5m])) > 0",
          "legendFormat": "{{log}}",
          "refId": "A"
        }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 17 },
      "id": 12,
      "options": {
        "legend": { "displayMode": "hidden" },
        "pieType": "donut",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "tooltip": { "mode": "single" }
      },
      "title": "Total Certs by Source",
      "description": "Total certificates received from each source since server start.",
      "type": "piechart",
      "targets": [
        {
          "expr": "topk(15, certstream_messages_sent) > 0",
          "legendFormat": "{{log}}",
          "refId": "A"
        }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 25 },
      "id": 102,
      "title": "Throughput & Performance",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "axisLabel": "certs/sec", "drawStyle": "line", "fillOpacity": 20, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never", "stacking": { "group": "A", "mode": "none" } },
          "unit": "short"
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Duplicates filtered/sec" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Unique certs/sec" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 26 },
      "id": 20,
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Aggregate Throughput",
      "type": "timeseries",
      "targets": [
        { "expr": "sum(rate(certstream_messages_sent[1m]))", "legendFormat": "Unique certs/sec", "refId": "A" },
        { "expr": "rate(certstream_duplicates_filtered[1m])", "legendFormat": "Duplicates filtered/sec", "refId": "B" }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "percentunit"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 26 },
      "id": 21,
      "options": {
        "legend": { "calcs": ["mean", "lastNotNull"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Dedup Efficiency",
      "description": "Percentage of incoming certificates that are duplicates (filtered out by cross-log dedup).",
      "type": "timeseries",
      "targets": [
        { "expr": "rate(certstream_duplicates_filtered[5m]) / clamp_min(sum(rate(certstream_messages_sent[5m])) + rate(certstream_duplicates_filtered[5m]), 1)", "legendFormat": "Dedup ratio", "refId": "A" }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 34 },
      "id": 103,
      "title": "Connections",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "axisLabel": "connections", "drawStyle": "line", "fillOpacity": 30, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never", "stacking": { "group": "A", "mode": "normal" } },
          "unit": "short"
        },
        "overrides": [
          { "matcher": { "id": "byName", "options": "Full" }, "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Lite" }, "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "Domains" }, "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }] },
          { "matcher": { "id": "byName", "options": "SSE" }, "properties": [{ "id": "color", "value": { "fixedColor": "purple", "mode": "fixed" } }] }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 35 },
      "id": 30,
      "options": {
        "legend": { "calcs": ["lastNotNull", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Active Connections",
      "type": "timeseries",
      "targets": [
        { "expr": "certstream_ws_connections_full", "legendFormat": "Full", "refId": "A" },
        { "expr": "certstream_ws_connections_lite", "legendFormat": "Lite", "refId": "B" },
        { "expr": "certstream_ws_connections_domains", "legendFormat": "Domains", "refId": "C" },
        { "expr": "certstream_sse_connections", "legendFormat": "SSE", "refId": "D" }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 35 },
      "id": 31,
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Rejected & Rate Limited",
      "type": "timeseries",
      "targets": [
        { "expr": "rate(certstream_connection_limit_rejected[5m])", "legendFormat": "Connection limit", "refId": "A" },
        { "expr": "rate(certstream_per_ip_limit_rejected[5m])", "legendFormat": "Per-IP limit", "refId": "B" },
        { "expr": "rate(certstream_rate_limit_rejected[5m])", "legendFormat": "Rate limit ({{reason}})", "refId": "C" },
        { "expr": "rate(certstream_auth_rejected[5m])", "legendFormat": "Auth rejected", "refId": "D" }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 43 },
      "id": 104,
      "title": "Static CT (v1.2.0)",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 44 },
      "id": 40,
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Static CT Entries Parsed (per log)",
      "type": "timeseries",
      "targets": [{ "expr": "rate(certstream_static_ct_entries_parsed[5m]) > 0", "legendFormat": "{{log}}", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 44 },
      "id": 41,
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Static CT Tiles Fetched (per log)",
      "type": "timeseries",
      "targets": [{ "expr": "rate(certstream_static_ct_tiles_fetched[5m]) > 0", "legendFormat": "{{log}}", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 44 },
      "id": 42,
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "title": "Errors & Parse Failures",
      "type": "timeseries",
      "targets": [
        { "expr": "rate(certstream_static_ct_checkpoint_errors[5m])", "legendFormat": "Checkpoint errors", "refId": "A" },
        { "expr": "sum by (log) (rate(certstream_static_ct_parse_failures[5m])) > 0", "legendFormat": "Parse fail: {{log}}", "refId": "B" },
        { "expr": "sum by (log) (rate(certstream_parse_failures[5m])) > 0", "legendFormat": "Parse fail: {{log}}", "refId": "C" }
      ]
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 52 },
      "id": 105,
      "title": "Dedup & Caching",
      "type": "row"
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 53 },
      "id": 50,
      "options": {
        "legend": { "calcs": ["lastNotNull"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi" }
      },
      "title": "Dedup Cache Size",
      "type": "timeseries",
      "targets": [{ "expr": "certstream_dedup_cache_size", "legendFormat": "Entries", "refId": "A" }]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 20, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 53 },
      "id": 51,
      "options": {
        "legend": { "calcs": ["lastNotNull"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi" }
      },
      "title": "Issuer Cache",
      "type": "timeseries",
      "targets": [
        { "expr": "certstream_issuer_cache_size", "legendFormat": "Size", "refId": "A" },
        { "expr": "rate(certstream_issuer_cache_hits[1m])", "legendFormat": "Hits/sec", "refId": "B" },
        { "expr": "rate(certstream_issuer_cache_misses[1m])", "legendFormat": "Misses/sec", "refId": "C" }
      ]
    },
    {
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": { "axisBorderShow": false, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "scheme", "lineInterpolation": "smooth", "lineWidth": 2, "showPoints": "never" },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 53 },
      "id": 52,
      "options": {
        "legend": { "calcs": ["mean", "max"], "displayMode": "table", "placement": "bottom" },
        "tooltip": { "mode": "multi" }
      },
      "title": "Log Health & Message Lag",
      "type": "timeseries",
      "targets": [
        { "expr": "rate(certstream_log_health_checks_failed[5m])", "legendFormat": "Health check fail/sec", "refId": "A" },
        { "expr": "rate(certstream_ws_messages_lagged[5m])", "legendFormat": "WS lag/sec", "refId": "B" }
      ]
    }
  ],
  "refresh": "10s",
  "schemaVersion": 39,
  "tags": ["certstream", "ct-logs", "certificates"],
  "templating": {
    "list": [
      {
        "current": { "selected": false, "text": "Prometheus", "value": "Prometheus" },
        "hide": 0,
        "includeAll": false,
        "label": "Datasource",
        "multi": false,
        "name": "DS_PROMETHEUS",
        "options": [],
        "query": "prometheus",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "Certstream Server",
  "uid": "certstream-server-rust",
  "version": 2
}
